<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elements - Connecting Points</title>

  <style>
    :root{
      --bg1:#f6fbff;
      --bg2:#f9fffe;
      --card:#ffffff;
      --text:#16312c;
      --muted:#56706a;
      --accent:#5cc8b4;
      --accent2:#3fb7a1;
      --border:#e2f1ee;
      --shadow: 0 10px 28px rgba(0,0,0,0.08);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      color: var(--text);
      min-height: 100vh;
      padding: 14px;
    }

    .wrap{
      max-width: 560px;
      margin: 0 auto;
      min-height: calc(100vh - 28px);
      display:flex;
      flex-direction:column;
      gap: 14px;
    }

    .topControls{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 12px;
      transition: all 0.35s ease;
    }

    .wrap.centerMode{
      justify-content:center;
      align-items:stretch;
    }
    .wrap.centerMode .topControls{
      max-width: 520px;
      margin: 0 auto;
    }

    .wrap.activeMode{
      justify-content:flex-start;
    }

    .controlsRow{
      display:grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      align-items:center;
    }

    select{
      width: 100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      outline: none;
      font-size: 1rem;
      background: #ffffff;
      color: var(--text);
      box-shadow: 0 4px 14px rgba(0,0,0,0.03) inset;
    }

    select:focus{
      border-color: var(--accent2);
      box-shadow: 0 0 0 3px rgba(63,183,161,0.16);
    }

    button{
      border: none;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 900;
      font-size: 1rem;
      cursor:pointer;
      white-space:nowrap;
    }

    .findBtn{
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      color: white;
      min-width: 88px;
    }

    .miniBtns{
      display:flex;
      gap: 10px;
    }

    .ghostBtn{
      background: #f2fffc;
      border: 1px solid var(--border);
      color: #247b6c;
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 0.95rem;
      cursor:pointer;
    }

    .content{
      display:none;
      gap: 14px;
      flex-direction:column;
    }

    .wrap.activeMode .content{
      display:flex;
      animation: fadeIn 0.35s ease;
    }

    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .panel{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .panelTitle{
      margin:0 0 10px;
      font-weight: 900;
      font-size: 1rem;
      color: var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
    }

    .badge{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f5fffd;
      color: var(--muted);
      font-size: 0.82rem;
      font-weight: 800;
      white-space: nowrap;
    }

    .scrollBox{
      border: 1px solid var(--border);
      border-radius: 16px;
      background: #fbffff;
      padding: 12px;
      max-height: 190px;
      overflow:auto;
    }

    .block{
      border: 1px solid var(--border);
      background: #ffffff;
      border-radius: 16px;
      padding: 12px;
      margin-bottom: 10px;
    }
    .block:last-child{ margin-bottom:0; }

    .blockHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .pill{
      padding: 5px 10px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 0.85rem;
      border: 1px solid var(--border);
    }
    .yin{ background:#f0fffb; color:#1c7264; }
    .yang{ background:#fff8f0; color:#7a4b16; }

    .points{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
    }

    .chip{
      padding: 8px 10px;
      border-radius: 999px;
      background: #f2fffb;
      border: 1px solid var(--border);
      font-weight: 900;
      font-size: 0.92rem;
      color: var(--text);
      cursor:pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease;
      user-select:none;
    }

    .chip:active{
      transform: scale(0.98);
    }

    .chip.selected{
      background: #e7fffa;
      border-color: rgba(63,183,161,0.5);
      box-shadow: 0 8px 18px rgba(63,183,161,0.18);
    }

    .emptyState{
      color: var(--muted);
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .imgBox{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px;
      overflow:hidden;
    }

    .imgPlaceholder{
      width: 100%;
      aspect-ratio: 4 / 3;
      border-radius: 18px;
      background: linear-gradient(135deg, #e6fbff, #f7ffe9);
      border: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      color: rgba(22,49,44,0.5);
      font-size: 1.1rem;
      text-align:center;
      padding: 10px;
    }

    .imgActual{
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      border-radius: 18px;
      border: 1px solid var(--border);
      display:none;
      background: #ffffff;
    }

    .descBox{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .descTitle{
      margin:0 0 8px;
      font-weight: 900;
      font-size: 1rem;
      color: var(--muted);
    }

    .descText{
      margin:0;
      color: var(--text);
      line-height: 1.45;
      font-size: 0.95rem;
    }

    .loadingLine{
      color: var(--muted);
      font-weight: 800;
      font-size: 0.95rem;
      padding: 6px 2px;
    }

    @media (max-width: 420px){
      .controlsRow{
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto auto;
      }
      .controlsRow button{
        grid-column: 1 / -1;
      }
    }
  </style>
</head>

<body>
  <div class="wrap centerMode" id="wrap">

    <!-- Controls -->
    <div class="topControls">
      <div class="controlsRow">
        <select id="el1" disabled>
          <option value="" selected disabled>Loading...</option>
        </select>

        <select id="el2" disabled>
          <option value="" selected disabled>Loading...</option>
        </select>

        <button class="findBtn" id="btnFind" disabled>Find</button>
      </div>

      <div class="miniBtns">
        <button class="ghostBtn" id="btnSwap" disabled>Swap</button>
        <button class="ghostBtn" id="btnReset" disabled>Reset</button>
      </div>

      <div class="loadingLine" id="loadStatus">Loading data from JSON...</div>
    </div>

    <!-- Content -->
    <div class="content" id="content">
      <div class="panel">
        <div class="panelTitle">
          <span>Connecting Points</span>
          <span class="badge" id="pairBadge">—</span>
        </div>

        <div class="scrollBox" id="outputBox"></div>
        <div class="loadingLine" style="padding-top:10px;">
          Tap any point chip to load Image + Description.
        </div>
      </div>

      <!-- Image -->
      <div class="imgBox">
        <div class="imgPlaceholder" id="imgHolder">Image Placeholder</div>
        <img id="imgActual" class="imgActual" alt="Point Image"/>
      </div>

      <!-- Description -->
      <div class="descBox">
        <div class="descTitle" id="descTitle">Description</div>
        <p class="descText" id="descText">
          Select two elements and tap <b>Find</b>. Then tap any connecting point.
        </p>
      </div>
    </div>

  </div>

  <script>
    // ✅ Loaded from JSON (acup.json)
    let db = null;

    // Track selected chip
    let selectedPointCode = null;

    const wrap = document.getElementById("wrap");

    const el1 = document.getElementById("el1");
    const el2 = document.getElementById("el2");

    const btnFind  = document.getElementById("btnFind");
    const btnSwap  = document.getElementById("btnSwap");
    const btnReset = document.getElementById("btnReset");

    const outputBox = document.getElementById("outputBox");
    const pairBadge = document.getElementById("pairBadge");

    const imgHolder = document.getElementById("imgHolder");
    const imgActual = document.getElementById("imgActual");

    const descTitle = document.getElementById("descTitle");
    const descText  = document.getElementById("descText");

    const loadStatus = document.getElementById("loadStatus");

    function setActiveMode(active){
      if(active){
        wrap.classList.remove("centerMode");
        wrap.classList.add("activeMode");
      }else{
        wrap.classList.remove("activeMode");
        wrap.classList.add("centerMode");
      }
    }

    function toTitleCase(s){
      return (s || "").slice(0,1).toUpperCase() + (s || "").slice(1);
    }

    function sanitizeCode(code){
      return (code || "").trim();
    }

    function setSelectedChip(pointCode){
      selectedPointCode = pointCode;

      // remove old selection
      document.querySelectorAll(".chip").forEach(ch => ch.classList.remove("selected"));

      // add selection to the clicked one
      const active = document.querySelector(`.chip[data-code="${CSS.escape(pointCode)}"]`);
      if(active) active.classList.add("selected");
    }

    function showPointDetails(pointCode){
      const code = sanitizeCode(pointCode);
      const pointData = db?.points?.[code];

      setSelectedChip(code);

      if(!pointData){
        imgActual.style.display = "none";
        imgActual.src = "";

        imgHolder.style.display = "flex";
        imgHolder.textContent = `No Image Found for ${code}`;

        descTitle.textContent = "Description";
        descText.innerHTML = `No description available for <b>${code}</b>. Add it inside JSON under <b>"points"</b>.`;
        return;
      }

      // Title
      descTitle.textContent = pointData.name ? pointData.name : `Point ${code}`;

      // Description
      descText.textContent = pointData.description || "No description provided.";

      // Image
      if(pointData.image){
        imgHolder.style.display = "none";
        imgActual.style.display = "block";

        imgActual.onerror = () => {
          imgActual.style.display = "none";
          imgActual.src = "";
          imgHolder.style.display = "flex";
          imgHolder.textContent = `Image failed to load for ${code}`;
        };

        imgActual.src = pointData.image;
      }else{
        imgActual.style.display = "none";
        imgActual.src = "";

        imgHolder.style.display = "flex";
        imgHolder.textContent = `No Image URL for ${code}`;
      }
    }

    function chips(list){
      if(!list || list.length === 0){
        return `<div class="emptyState">No points available for this pair.</div>`;
      }
      return `
        <div class="points">
          ${list.map(x => `<span class="chip" data-code="${x}">${x}</span>`).join("")}
        </div>
      `;
    }

    function attachChipClickHandlers(){
      const chips = document.querySelectorAll(".chip");
      chips.forEach(ch => {
        ch.addEventListener("click", () => {
          const code = ch.getAttribute("data-code");
          showPointDetails(code);
        });
      });
    }

    function renderResult(a, b){
      const cell = db?.table?.[a]?.[b];
      pairBadge.textContent = `${toTitleCase(a)} × ${toTitleCase(b)}`;

      // Reset point area for new pair
      selectedPointCode = null;
      descTitle.textContent = "Description";
      descText.innerHTML = `Tap any connecting point to load image + description.`;

      imgActual.style.display = "none";
      imgActual.src = "";
      imgHolder.style.display = "flex";
      imgHolder.textContent = "Image Placeholder";

      if(!cell){
        outputBox.innerHTML = `<div class="emptyState">No mapping exists for this pair.</div>`;
        return;
      }

      outputBox.innerHTML = `
        <div class="block">
          <div class="blockHead">
            <strong>Connecting Points</strong>
            <span class="pill yin">YIN</span>
          </div>
          ${chips(cell.yin)}
        </div>

        <div class="block">
          <div class="blockHead">
            <strong>Connecting Points</strong>
            <span class="pill yang">YANG</span>
          </div>
          ${chips(cell.yang)}
        </div>
      `;

      attachChipClickHandlers();
    }

    function fillDropdown(selectEl, elements){
      selectEl.innerHTML = `
        <option value="" selected disabled>Select</option>
        ${elements.map(e => `<option value="${e}">${toTitleCase(e)}</option>`).join("")}
      `;
    }

    async function loadJson(){
      try{
        loadStatus.textContent = "Loading data from JSON...";
        const res = await fetch("./acup.json", { cache: "no-store" });

        if(!res.ok){
          throw new Error("Could not load acup.json");
        }

        db = await res.json();

        if(!db?.elements || !db?.table){
          throw new Error("JSON format invalid (missing elements/table).");
        }

        fillDropdown(el1, db.elements);
        fillDropdown(el2, db.elements);

        el1.disabled = false;
        el2.disabled = false;
        btnFind.disabled = false;
        btnSwap.disabled = false;
        btnReset.disabled = false;

        loadStatus.textContent = "Ready ✅ Select elements and tap Find.";
      }catch(err){
        console.error(err);
        loadStatus.textContent = "Error: Could not load JSON data ❌";
        alert("Failed to load acup.json.\n\nMake sure:\n1) acup.json is in same folder\n2) You open with Live Server (not file://)");
      }
    }

    // ✅ Events
    btnFind.addEventListener("click", () => {
      const a = el1.value;
      const b = el2.value;

      if(!a || !b){
        alert("Please select both Element-1 and Element-2.");
        return;
      }

      setActiveMode(true);
      renderResult(a, b);

      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    btnSwap.addEventListener("click", () => {
      const a = el1.value;
      const b = el2.value;

      if(!a || !b){
        alert("Select both elements first, then swap.");
        return;
      }

      el1.value = b;
      el2.value = a;

      if(wrap.classList.contains("activeMode")){
        renderResult(el1.value, el2.value);
      }
    });

    btnReset.addEventListener("click", () => {
      el1.value = "";
      el2.value = "";

      setActiveMode(false);

      outputBox.innerHTML = "";
      pairBadge.textContent = "—";

      selectedPointCode = null;

      imgActual.style.display = "none";
      imgActual.src = "";
      imgHolder.style.display = "flex";
      imgHolder.textContent = "Image Placeholder";

      descTitle.textContent = "Description";
      descText.innerHTML = `Select two elements and tap <b>Find</b>. Then tap any connecting point.`;
    });

    // ✅ Start
    setActiveMode(false);
    loadJson();
  </script>
</body>
</html>
