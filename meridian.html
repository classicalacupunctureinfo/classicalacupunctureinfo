<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meridians Viewer</title>

  <style>
    :root {
      --bg: #061f22;
      --card: #0b2e31;
      --card2: #083034;
      --text: #e9ffff;
      --muted: #b7e7ea;
      --accent: #39d5d5;
      --accent2: #17aeb3;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
      --border: rgba(57,213,213,.22);
    }

    [data-theme="light"] {
      --bg: #f0f7f7;
      --card: #ffffff;
      --card2: #f9fdfd;
      --text: #132a2a;
      --muted: #5a7a7a;
      --accent: #0d9488;
      --accent2: #0f766e;
      --border: rgba(13, 148, 136, 0.15);
      --shadow: 0 12px 40px rgba(0, 50, 50, 0.1);
    }

    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 50% -10%, rgba(57,213,213,.12), transparent 60%),
                  linear-gradient(180deg, var(--bg), var(--bg));
      color: var(--text);
      min-height: 100vh;
      transition: background 0.4s ease, color 0.4s ease;
    }

    .app {
      max-width: 980px;
      margin: 0 auto;
      padding: 14px;
      padding-bottom: 30px;
    }

    header {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      position: sticky;
      top: 10px;
      z-index: 5;
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .title-group h1 {
      margin: 0;
      font-size: 18px;
      letter-spacing: .2px;
      line-height: 1.2;
    }

    .sub {
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
    }

    .grid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    @media (min-width: 520px) { .grid { grid-template-columns: repeat(3, minmax(0,1fr)); } }
    @media (min-width: 860px) { .grid { grid-template-columns: repeat(4, minmax(0,1fr)); } }

    .btn {
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      border-radius: 16px;
      padding: 12px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all .2s;
      min-height: 52px;
    }

    .btn:hover { border-color: var(--accent); }
    .btn.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .viewer {
      margin-top: 14px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .viewerTop {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 14px;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,0.02);
    }

    .viewerTitle { font-weight: 800; font-size: 16px; }

    .clearBtn {
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      border-radius: 10px;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
    }

    .content { padding: 16px; display: grid; gap: 16px; }

    .imgWrap {
      width: 100%;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.05);
    }

    img { width: 100%; height: auto; display: block; cursor: zoom-in; }

    .desc {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      background: rgba(0,0,0,0.02);
      white-space: pre-wrap;
      line-height: 1.6;
      font-size: 14px;
    }

    .pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 20px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.05);
      text-transform: uppercase;
      font-weight: 600;
    }

    /* Theme Toggle */
    .theme-toggle {
      width: 44px; height: 24px; background: rgba(0,0,0,0.1); border: 1px solid var(--border);
      border-radius: 20px; position: relative; cursor: pointer; display: flex; align-items: center;
      transition: 0.3s;
    }
    .theme-toggle::after {
      content: 'üåô'; position: absolute; left: 4px; font-size: 12px;
      transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    [data-theme="light"] .theme-toggle::after { content: '‚òÄÔ∏è'; left: 24px; }

    /* Modal */
    .img-modal {
      position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.9); z-index: 9999;
    }
    .img-modal.open { display: flex; }
    .img-modal img { max-width: 95%; max-height: 95%; cursor: zoom-out; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title-group">
        <h1>Meridian Viewer</h1>
        <div class="sub">Tap a button to inspect details.</div>
      </div>
      <div class="theme-toggle" id="themeToggle" title="Toggle Appearance"></div>
    </header>

    <section class="grid" id="btnGrid"></section>

    <section class="viewer" id="viewer">
      <div class="viewerTop">
        <div>
          <div class="viewerTitle" id="viewerTitle">Select a meridian</div>
          <div class="sub" id="viewerMini">Status: <span id="imgName">Idle</span></div>
        </div>
        <button class="clearBtn" id="clearBtn">Clear</button>
      </div>

      <div class="content" id="viewerContent">
        <div style="text-align:center; padding: 40px 0; opacity: 0.6;">
          Please choose a meridian from the grid above.
        </div>
      </div>
    </section>
  </div>

  <div id="imgModal" class="img-modal">
    <img id="imgModalImg" src="" alt="Fullscreen view" />
  </div>

  <script>
    const MERIDIANS = [
      { name: "Heart", code: "HTM" }, { name: "Pericardium", code: "PCM" },
      { name: "Small Intestine", code: "SIM" }, { name: "Triple Warmer", code: "TWM" },
      { name: "Spleen", code: "SPM" }, { name: "Stomach", code: "STM" },
      { name: "Lung", code: "LUM" }, { name: "Large Intestine", code: "LIM" },
      { name: "Kidney", code: "KDM" }, { name: "Urinary Bladder", code: "UBM" },
      { name: "Liver", code: "LVM" }, { name: "Gall Bladder", code: "GBM" }
    ];

    const btnGrid = document.getElementById("btnGrid");
    const viewerTitle = document.getElementById("viewerTitle");
    const viewerContent = document.getElementById("viewerContent");
    const themeToggle = document.getElementById("themeToggle");
    const imgModal = document.getElementById("imgModal");
    const imgModalImg = document.getElementById("imgModalImg");

    function initTheme() {
      const saved = localStorage.getItem("five_elements_theme") || "dark";
      document.documentElement.setAttribute("data-theme", saved);
    }

    themeToggle.onclick = () => {
      const current = document.documentElement.getAttribute("data-theme");
      const target = current === "light" ? "dark" : "light";
      document.documentElement.setAttribute("data-theme", target);
      localStorage.setItem("five_elements_theme", target);
    };

    function createButtons() {
      MERIDIANS.forEach(m => {
        const b = document.createElement("button");
        b.className = "btn";
        b.textContent = m.name;
        b.onclick = () => openMeridian(m, b);
        btnGrid.appendChild(b);
      });
    }

    async function openMeridian(item, btn) {
      document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      viewerTitle.textContent = item.name;
      viewerContent.innerHTML = `<div style="text-align:center; padding:20px;">Loading...</div>`;

      let description = "Description file not found.";
      try {
        const res = await fetch(`meridian_txt/${item.code}.txt`);
        if (res.ok) description = await res.text();
      } catch (e) {}

      viewerContent.innerHTML = `
        <div class="imgWrap">
          <img src="meridian_img/${item.code}.jpg" alt="${item.name}" 
               onerror="this.style.display='none'; this.parentNode.innerHTML='<div style=\'padding:40px;text-align:center;opacity:0.5\'>Image: ${item.code}.jpg not found</div>'"
               onclick="showModal(this.src)">
        </div>
        <div class="desc">${description}</div>
        <div style="display:flex; gap:8px;">
          <span class="pill">Code: ${item.code}</span>
          <span class="pill">System: Classical</span>
        </div>
      `;
      document.getElementById("viewer").scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function showModal(src) {
      imgModalImg.src = src;
      imgModal.classList.add('open');
    }

    imgModal.onclick = () => imgModal.classList.remove('open');

    document.getElementById("clearBtn").onclick = () => {
      document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
      viewerTitle.textContent = "Select a meridian";
      viewerContent.innerHTML = `<div style="text-align:center; padding: 40px 0; opacity: 0.6;">Please choose a meridian from the grid above.</div>`;
    };

    initTheme();
    createButtons();
  </script>
</body>
</html>
